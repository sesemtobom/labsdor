<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Extrator de Exames</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    textarea { width: 100%; height: 300px; margin-bottom: 20px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #output { white-space: pre-wrap; margin-top: 20px; background: #f9f9f9; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Extrator de Resultados de Exames</h2>
  <textarea id="input" placeholder="Cole aqui o conteúdo do exame..."></textarea>
  <button onclick="extrair()">Extrair</button>
  <div id="output"></div>

  <script>
    function extrair() {
      const texto = document.getElementById("input").value;

      const regexes = {
        Hb: /Hemoglobina[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Ht: /Hemat[oó]crito[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        L: /Leuc[oó]citos[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        N: /Neut[róo]filos[\s\S]*?(\d+[\.,]?\d*)\s*\/mm³/,
        Ly: /Linf[oó]citos[\s\S]*?(\d+[\.,]?\d*)\s*\/mm³/,
        Plq: /Plaquetas[\s\S]*?[:\s](\d+)[^\d]/,
        PCR: /Prote[ií]na C Reativa[\s\S]*?[:\s](Inferior a [\d,]+|\d+[\.,]?\d*)/,
        HbGli: /Glicose[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        U: /Ureia[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Cr: /Creatinina[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Na: /S[oó]dio[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        K: /Pot[áa]ssio[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Cat: /C[áa]lcio I[oô]nico[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Mg: /Magn[ée]sio[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Bt: /Bilirrubina Total[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Bi: /Bilirrubina Indireta[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Bd: /Bilirrubina Direta[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        TGo: /(AST|TGO)[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        TGP: /(ALT|TGP)[\s\S]*?[:\s](\d+[\.,]?\d*)/,
        Gaso_pH: /pH\s*[:\s](\d+[\.,]?\d*)/,
        Gaso_BIC: /HCO[₃3]\s*[:\s](\d+[\.,]?\d*)/,
        Gaso_Lac: /[ÁA]cido L[áa]tico\s*[:\s](\d+[\.,]?\d*)/
      };

      const resultados = [];

      for (const [chave, padrao] of Object.entries(regexes)) {
        const match = texto.match(padrao);
        if (match) {
          let valor = match[1] || match[2]; // para TGO/TGP que têm dois grupos
          valor = valor.replace(",", ".");
          if (chave === "PCR" && valor.toLowerCase().includes("inferior")) {
            valor = "<" + valor.match(/[\d,\.]+/)[0].replace(",", ".");
          }
          if (chave === "Plq") {
            valor = (parseInt(valor) * 1000).toString();
          }
          resultados.push({ chave, valor });
        }
      }

      // Ordenar e formatar
      const ordem = ["Hb", "Ht", "L", "N", "Ly", "Plq", "PCR", "HbGli", "U", "Cr", "Na", "K", "Cat", "Mg", "Bt", "Bi", "Bd", "TGo", "TGP"];
      const gasoKeys = ["Gaso_pH", "Gaso_BIC", "Gaso_Lac"];
      const principal = ordem
        .map(k => {
          const item = resultados.find(r => r.chave === k);
          return item ? `${item.chave} ${item.valor}` : null;
        })
        .filter(Boolean)
        .join(" I ");

      const gasoPartes = gasoKeys
        .map(k => {
          const item = resultados.find(r => r.chave === k);
          if (!item) return null;
          const label = k === "Gaso_pH" ? "pH" : k === "Gaso_BIC" ? "BIC" : "Lac";
          return `${label} ${item.valor}`;
        })
        .filter(Boolean)
        .join(" - ");

      const final = principal + (gasoPartes ? ` I GasoV: ${gasoPartes}` : "");

      document.getElementById("output").textContent = final || "Nenhum dado encontrado.";
    }
  </script>
</body>
</html>
